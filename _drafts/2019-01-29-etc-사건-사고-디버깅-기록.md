---
layout: post
date: 2019-01-29 20:18:00 +0900
title: 'etc: 사건 사고 디버깅 기록'
categories:
  - etc
tags:
  - history
---

* Kramdown table of contents
{:toc .toc}

## 오라클 DB 조회 속도 저하

- 일시: 2017-??-??
- 프로젝트: 이뿅너뿅 차세대

JDBC 커넥션을 통해 오라클 DB를 조회하는 속도가 엄청나게 느려서 이래저래 테스트해봤더니 결론은: JDBC 커넥션은 잘못이 없고, DB 자체의 이상으로 데이터를 FETCH 하는 속도가 느린게 원인.

FETCH가 느린거라서 DB 툴을 사용해 테스트하려면 SELECT가 아니라 CREATE TABLE AS로 확인해야 했다. (DB 툴에서 SELECT를 하면 일정 단위씩 끊어서 FETCH 하기 때문)

스프링 프레임웤 환경 말고 직접 커넥션을 만들어서 테스트해보기도 했었음.

## 이미지 자동 삭제 사건

- 일시: 2017-??-??
- 프로젝트: 이뿅너뿅 차세대

톰캣의 docBase 아래에 이미지 서버로 연결되는 심볼릭 링크를 생성, 이 후 톰캣의 autoDeploy 기능이 작동할 때마다 이미지들이 재귀적으로 삭제된 사건. 원인은 톰캣의 autoDeploy 때문이었음.

## DNS 캐시 사건

- 일시: 2018-10-??
- 프로젝트: 뿅뿅복권 수행사 이관

ASIS에서 사용하던 도메인에 A서버의 임시페이지를 연결해놓은 상태. 오픈 시점에 도메인의 연결을 B서버로 변경했으나 DNS 자체 캐시가 남아있어서 약 20시간 가량 사이트 접속 장애가 발생한 사건. PC에 따라 증상이 달랐는데 아무 문제 없는 PC도 있었지만 안되는 PC는 A서버의 임시페이지로 가거나, B서버로 연결되었으나 이미지나 스크립트 등이 제대로 불러와지지 않기도 함. 모바일도 마찬가지.

## 페이징 쿼리와 마이바티스 collection의 동시 사용

- 일시: 2019-01-30
- 프로젝트: 뿅쇼핑 차세대

마이바티스 collection으로 걸러낼 생각으로 이퀴 조인 결과물이 나오게 쿼리를 작성해놨다가, 이 쿼리에 페이징을 적용해버린 사건. 이러면 마이바티스가 뭔갈 하기도 전에 페이징 쿼리로 제한된 데이터가 나와버리니 의도한 것과는 전혀 딴판의 결과물이 나온다.

## 본사 갔다 왔더니 의자가 사라졌다.

- 일시: 2019-03-11
- 프로젝트: 뿅쇼핑 차세대

자리가 없다길래 본사에서 몇 달 있다 왔더니 내 의자가 사라진 사건. 어디 갔다 올 때는 의자도 반드시 찜해야 한다.

## HashMap으로는 마이바티스 컬렉션 기능이 제대로 작동하지 않음.

- 일시: 2019-03-11
- 프로젝트: 뿅쇼핑 차세대

테스트 삼아 HashMap으로 type 설정해서 해봤는데, 부모 하나 자식 하나 손자 하나 이런식으로 나온다. 마이바티스에 버그가 있다거나...

## jackson: `@JsonProperty` 사용 시 자바빈 표준 명명법을 따르지 않음.

- 2019-04-28
- 프로젝트: 뿅쇼핑 차세대

자바빈 표준 명명법을 따르지 않은 변수(대문자로 시작하는 변수라던가)에 `@JsonProperty`를 적용하면서 동시에 필드명과 다른 이름을 지어주면 파싱결과가 중복되는 현상이 발생한다. 예를 들어 `Abc`라는 필드에 `@JsonProperty(value = abc)` 어노테이션을 명시하면(혹은 반대로 하거나) JSON 결과값이 abc, Abc 두 개로 나타난다. Java beans introspection과 관련 있는걸로 보인다.

## 파이어폭스의 특정 url로의 xhr 요청 차단

- 2019-05-01
- 프로젝트: 홈웤

파이어폭스에서 언젠가부터 잘 되던 xhr 요청이 씹히던 현상이 있었는데(같은 걸 크롬에서 테스트하면 잘 됨), 테스트해보니 url에 'read-payload'가 있으면 요청을 차단하는걸로 추정됨. 아마도 보안 이슈인 모양.

## UI 플러그인: swiper.js 사용 시 안보이는 대상에 적용 시 이상현상 발생

- 2019-05-02
- 프로젝트: 뿅쇼핑 차세대
- [플러그인 공식 페이지](http://idangero.us/swiper/)
- [깃허브](https://github.com/nolimits4web/swiper)

스와이퍼 적용 대상 혹은 그 부모가 hidden 상태일 때(`display` 이 `none`일 때) 스와이퍼를 초기화 하면 적용이 안돼거나 이상하게 적용되는 현상이 있다.

이 때는 스와이퍼 초기화 시 다음처럼:

```
var reviewPhoto = new Swiper('.reviewPhoto', {
  slidesPerView: 1,
  loop: true,
  spaceBetween: 8,
  observer: true,
  observeParents: true,
  // 생략
```

`observer: true`와 `observeParents: true`를 추가하면 된다.
